<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Java ì½”ë“œ í”¼ë“œë°±</title>
    <!-- ì½”ë“œ ì–´ë‘ìš´ í…Œë§ˆ -->
    <!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>-->
    <!-- ì½”ë“œ ë°ì€ í…Œë§ˆ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"/>

    <!-- HEADì— ì¶”ê°€ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #container {
            position: relative;
            width: 1100px; /* ë„‰ë„‰í•œ ê°€ë¡œ */
            height: 700px; /* ì¶©ë¶„í•œ ì„¸ë¡œ */
            overflow: auto;
            border: 1px solid #ccc;
        }


        pre {
            margin: 0;
            height: 100%;
            overflow: auto;
        }

        code {
            font-size: 10px;
        }

        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: none;
            pointer-events: none;
        }

        #drawingCanvas.active {
            display: block;
            pointer-events: auto;
        }

        #controls {
            margin-top: 1rem;
        }

        button {
            margin-right: 0.5rem;
        }
    </style>
</head>

<body>

<h2>ğŸ“ Java ì½”ë“œ í”¼ë“œë°±</h2>

<div id="container">
    <!-- ì½”ë“œ ì˜ì—­ -->
    <pre><code class="language-java" id="codeBlock">// ë¡œë”© ì¤‘...</code></pre>

    <!-- ìº”ë²„ìŠ¤ -->
    <canvas id="drawingCanvas"></canvas>
</div>

<div id="controls">
    <button onclick="toggleDrawing()">âœï¸ íœ í™œì„±í™”</button>
    <button onclick="clearCanvas()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
    <button onclick="saveDrawing()">ğŸ’¾ ì´ë¯¸ì§€ ì €ì¥</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>

<script>
    const targetUrl = "https://raw.githubusercontent.com/kdit-2024-08month/spring-v4/master/src/main/java/org/example/springv3/user/UserService.java";

    // ì½”ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadCode() {
        try {
            const response = await fetch(targetUrl);
            if (!response.ok) throw new Error("ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            const code = await response.text();
            const codeBlock = document.getElementById('codeBlock');
            codeBlock.textContent = code;
            Prism.highlightElement(codeBlock);
        } catch (err) {
            document.getElementById('codeBlock').textContent = err.message;
        }
    }

    loadCode();

    // ë“œë¡œì‰ ìº”ë²„ìŠ¤ ì„¤ì •
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    function resizeCanvas() {
        const container = document.getElementById('container');
        const ratio = window.devicePixelRatio || 1;
        canvas.width = container.clientWidth * ratio;
        canvas.height = container.clientHeight * ratio;
        canvas.style.width = container.clientWidth + 'px';
        canvas.style.height = container.clientHeight + 'px';
        ctx.setTransform(1, 0, 0, 1, 0, 0); // reset
        ctx.scale(ratio, ratio);
    }

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function toggleDrawing() {
        canvas.classList.toggle('active');
    }

    canvas.addEventListener('mousedown', (e) => {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!drawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
    });

    canvas.addEventListener('mouseup', () => {
        drawing = false;
    });

    // ë³€ê²½ëœ saveDrawing í•¨ìˆ˜
    function saveDrawing() {
        const container = document.getElementById('container');

        // ìº”ë²„ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ z-index ë†’ì—¬ì„œ ë³´ì´ê²Œ
        canvas.classList.add('active');

        // ì ê¹ ê¸°ë‹¤ë ¸ë‹¤ê°€ ìº¡ì³
        setTimeout(() => {
            html2canvas(container, {
                scale: 2,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'feedback.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }, 100); // DOM ì—…ë°ì´íŠ¸ ê¸°ë‹¤ë¦¼
    }


    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
</script>

</body>

</html>
