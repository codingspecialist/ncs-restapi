{{> layout/header}}

<div class="container mt-5 mb-5">
    <div class="subject-form-card">
        <div class="card-header">과정 등록</div>

        <form id="courseForm" action="/api/course-menu/course/save" method="post">

            <div class="form-section">
                <label class="form-label">과정명</label>
                <input type="text" class="form-control" name="title" value="AWS 클라우드 양성 과정" placeholder="과정명">
            </div>

            <div class="form-section">
                <label class="form-label">과정 ID</label>
                <input type="text" class="form-control" name="code" value="C1001" placeholder="과정 ID">
            </div>

            <div class="form-section">
                <label class="form-label">과정 수준</label>
                <input type="text" class="form-control" name="level" value="5" placeholder="수준">
            </div>

            <div class="form-section">
                <label class="form-label">과정 목표</label>
                <input type="text" class="form-control" name="purpose"
                       value="클라우드의 배포 학습 방법에 대해서 학습하고, devops 개발자를 목표로 한다."
                       placeholder="과정 목표">
            </div>

            <div class="form-section">
                <label class="form-label">과정 시간</label>
                <input type="text" class="form-control" name="totalTime" value="900" placeholder="시간">
            </div>

            <div class="form-section">
                <label class="form-label">과정 일수</label>
                <input type="text" class="form-control" name="totalDay" value="113" placeholder="일수">
            </div>

            <div class="form-section">
                <label class="form-label">회차</label>
                <input type="text" class="form-control" name="round" value="1" placeholder="회차">
            </div>

            <div class="form-section">
                <label class="form-label">시작일</label>
                <input type="date" class="form-control" name="startDate" value="2025-06-21">
            </div>

            <div class="form-section">
                <label class="form-label">종료일</label>
                <input type="date" class="form-control" name="endDate" value="2026-03-31">
            </div>

            <!-- 숨겨진 필드 -->
            <input type="hidden" name="mainTeacherId" id="mainTeacherInput">
            <input type="hidden" name="mainTeacherName" id="mainTeacherNameInput">

            <!-- 강사 선택 -->
            <div class="teacher-dnd-section">
                <div class="teacher-box-container">
                    <div class="teacher-box" id="all-teachers">
                        <b>전체 강사 목록</b>
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="이름으로 검색"
                               oninput="filterTeachers(this.value)">
                        <div id="all-teacher-list" class="all-teacher-list">
                            {{#models}}
                                <div class="teacher-item js-teacher-item" draggable="true" data-id="{{id}}" data-name="{{teacherName}}">
                                    {{nameAndUsername}}
                                </div>
                            {{/models}}
                        </div>
                    </div>

                    <div class="teacher-box" id="main-teacher">
                        <b>메인 강사 (1명)</b>
                    </div>

                    <div class="teacher-box" id="sub-teachers">
                        <b>보조 강사</b>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary mt-3 form-control">과정 등록</button>
        </form>
    </div>
</div>

<script>
    let dragged;

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.js-teacher-item').forEach(item => {
            item.addEventListener('dragstart', (e) => dragged = e.target);
        });
    });

    ['#all-teachers', '#main-teacher', '#sub-teachers'].forEach(selector => {
        const box = document.querySelector(selector);
        box.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        box.addEventListener('drop', (e) => {
            e.preventDefault();
            if (dragged) {
                const targetBox = e.currentTarget;
                const draggedId = dragged.getAttribute('data-id');
                const draggedName = dragged.getAttribute('data-name');

                // 메인 강사 박스에 드롭된 경우
                if (targetBox.id === 'main-teacher') {
                    // 기존 메인 강사 제거
                    const existingMainTeacher = targetBox.querySelector('.teacher-item');
                    if (existingMainTeacher) {
                        document.getElementById('all-teachers').querySelector('.all-teacher-list').appendChild(existingMainTeacher);
                    }

                    // 새 메인 강사 추가
                    targetBox.appendChild(dragged);
                    document.getElementById('mainTeacherInput').value = draggedId;
                    document.getElementById('mainTeacherNameInput').value = draggedName;
                }
                // 보조 강사 박스에 드롭된 경우
                else if (targetBox.id === 'sub-teachers') {
                    targetBox.appendChild(dragged);
                }
                // 전체 강사 목록으로 돌아간 경우
                else if (targetBox.id === 'all-teachers') {
                    targetBox.querySelector('.all-teacher-list').appendChild(dragged);
                    // 메인 강사에서 제거된 경우 hidden 필드 초기화
                    if (document.getElementById('mainTeacherInput').value === draggedId) {
                        document.getElementById('mainTeacherInput').value = '';
                        document.getElementById('mainTeacherNameInput').value = '';
                    }
                }
            }
        });
    });

    function filterTeachers(searchTerm) {
        const teacherItems = document.querySelectorAll('.js-teacher-item');
        teacherItems.forEach(item => {
            const teacherName = item.textContent.toLowerCase();
            if (teacherName.includes(searchTerm.toLowerCase())) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
</script>

{{> layout/footer}}
