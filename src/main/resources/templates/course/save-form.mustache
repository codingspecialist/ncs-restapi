{{> layout/header}}

<style>
    .subject-form-card {
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
        padding: 2.5rem;
        max-width: 900px;
        margin: 0 auto;
    }

    .subject-form-card .card-header {
        background-color: transparent;
        font-size: 1.5rem;
        font-weight: bold;
        border-bottom: 2px solid #eee;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
    }

    .form-label {
        font-weight: 600;
        margin-bottom: 0.3rem;
    }

    .form-control, .form-select {
        border-radius: 10px;
    }

    .btn-primary {
        padding: 0.75rem;
        font-weight: bold;
        font-size: 1rem;
        border-radius: 12px;
    }

    .form-section {
        margin-bottom: 1.4rem;
    }

    .teacher-dnd-section {
        background-color: #f5f7fa;
        border-radius: 12px;
        padding: 20px;
        margin-top: 30px;
        margin-bottom: 30px;
        box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
    }

    .teacher-box-container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        flex-wrap: wrap;
    }

    .teacher-box {
        flex: 1;
        min-width: 250px;
        background-color: #ffffff;
        border: 2px dashed #d3d3d3;
        border-radius: 12px;
        padding: 15px;
        min-height: 240px;
        overflow-y: auto;
        transition: background-color 0.3s;
    }

    .teacher-box:hover {
        background-color: #f0f8ff;
    }

    .teacher-box b {
        display: block;
        font-size: 16px;
        margin-bottom: 12px;
        color: #343a40;
    }

    .teacher-item {
        background-color: #e9ecef;
        border: 1px solid #ced4da;
        border-radius: 8px;
        padding: 8px 12px;
        margin-bottom: 6px;
        cursor: grab;
        font-size: 14px;
        color: #495057;
    }

    .teacher-item:hover {
        background-color: #dee2e6;
    }

    .all-teacher-list {
        max-height: 130px;
        overflow-y: auto;
    }
</style>

<div class="container mt-5 mb-5">
    <div class="subject-form-card">
        <div class="card-header">과정 등록</div>

        <form id="courseForm" action="/api/course-menu/course/save" method="post">

            <div class="form-section">
                <label class="form-label">과정명</label>
                <input type="text" class="form-control" name="title" value="자바 크로스 플랫폼 양성과정" placeholder="과정명">
            </div>

            <div class="form-section">
                <label class="form-label">과정 ID</label>
                <input type="text" class="form-control" name="code" value="C1001" placeholder="과정 ID">
            </div>

            <div class="form-section">
                <label class="form-label">과정 수준</label>
                <input type="text" class="form-control" name="level" value="5" placeholder="수준">
            </div>

            <div class="form-section">
                <label class="form-label">과정 목표</label>
                <input type="text" class="form-control" name="purpose" value="크로스 플랫폼 개발자가 되어서 풀스택을 달성한다"
                       placeholder="과정 목표">
            </div>

            <div class="form-section">
                <label class="form-label">과정 시간</label>
                <input type="text" class="form-control" name="totalTime" value="900" placeholder="시간">
            </div>

            <div class="form-section">
                <label class="form-label">과정 일수</label>
                <input type="text" class="form-control" name="totalDay" value="113" placeholder="일수">
            </div>

            <div class="form-section">
                <label class="form-label">회차</label>
                <input type="text" class="form-control" name="round" value="1" placeholder="회차">
            </div>

            <div class="form-section">
                <label class="form-label">시작일</label>
                <input type="date" class="form-control" name="startDate" value="2024-05-01">
            </div>

            <div class="form-section">
                <label class="form-label">종료일</label>
                <input type="date" class="form-control" name="endDate" value="2024-11-14">
            </div>

            <!-- 숨겨진 필드 -->
            <input type="hidden" name="mainTeacherId" id="mainTeacherInput">
            <input type="hidden" name="mainTeacherName" id="mainTeacherNameInput">

            <!-- 강사 선택 -->
            <div class="teacher-dnd-section">
                <div class="teacher-box-container">
                    <div class="teacher-box" id="all-teachers">
                        <b>전체 강사 목록</b>
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="이름으로 검색"
                               oninput="filterTeachers(this.value)">
                        <div id="all-teacher-list" class="all-teacher-list">
                            {{#models}}
                                <div class="teacher-item" draggable="true" data-id="{{id}}" data-name="{{teacherName}}">
                                    {{nameAndUsername}}
                                </div>
                            {{/models}}
                        </div>
                    </div>

                    <div class="teacher-box" id="main-teacher">
                        <b>메인 강사 (1명)</b>
                    </div>

                    <div class="teacher-box" id="sub-teachers">
                        <b>보조 강사</b>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary mt-3 form-control">과정 등록</button>
        </form>
    </div>
</div>

<script>
    let dragged;

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.teacher-item').forEach(item => {
            item.addEventListener('dragstart', (e) => dragged = e.target);
        });
    });

    ['#all-teachers', '#main-teacher', '#sub-teachers'].forEach(selector => {
        const box = document.querySelector(selector);

        box.addEventListener('dragover', e => e.preventDefault());

        box.addEventListener('drop', () => {
            const draggedFrom = dragged.parentElement.id;
            const mainBox = document.querySelector('#main-teacher');
            const subBox = document.querySelector('#sub-teachers');
            const allBox = document.querySelector('#all-teacher-list');
            const currentMain = mainBox.querySelector('.teacher-item');

            if (selector === '#main-teacher') {
                if (mainBox.contains(dragged)) return;
                if (currentMain) {
                    (draggedFrom === 'sub-teachers' ? subBox : allBox).appendChild(currentMain);
                }
                mainBox.innerHTML = '<b>메인 강사 (1명)</b>';
                mainBox.appendChild(dragged);
            } else if (selector === '#sub-teachers') {
                if (subBox.contains(dragged) || mainBox.contains(dragged)) return;
                subBox.appendChild(dragged);
            } else {
                if (allBox.contains(dragged)) return;
                allBox.appendChild(dragged);
            }

            updateHiddenInputs();
        });
    });

    function updateHiddenInputs() {
        const main = document.querySelector('#main-teacher .teacher-item');
        const subs = document.querySelectorAll('#sub-teachers .teacher-item');

        document.querySelector('#mainTeacherInput').value = main ? main.dataset.id : '';
        document.querySelector('#mainTeacherNameInput').value = main ? main.dataset.name : '';

        document.querySelectorAll('input[name="subTeacherIds"]').forEach(el => el.remove());

        const form = document.querySelector('#courseForm');
        subs.forEach(sub => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'subTeacherIds';
            input.value = sub.dataset.id;
            form.appendChild(input);
        });
    }

    function filterTeachers(keyword) {
        keyword = keyword.trim().toLowerCase();
        const items = document.querySelectorAll('#all-teacher-list .teacher-item');
        items.forEach(item => {
            const name = item.dataset.name.toLowerCase();
            item.style.display = name.includes(keyword) ? 'block' : 'none';
        });
    }
</script>

{{> layout/footer}}
